"use strict";(self.webpackChunkuseful_resources=self.webpackChunkuseful_resources||[]).push([[468],{9613:(e,a,o)=>{o.d(a,{Zo:()=>c,kt:()=>k});var t=o(9496);function r(e,a,o){return a in e?Object.defineProperty(e,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[a]=o,e}function n(e,a){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),o.push.apply(o,t)}return o}function i(e){for(var a=1;a<arguments.length;a++){var o=null!=arguments[a]?arguments[a]:{};a%2?n(Object(o),!0).forEach((function(a){r(e,a,o[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(o,a))}))}return e}function s(e,a){if(null==e)return{};var o,t,r=function(e,a){if(null==e)return{};var o,t,r={},n=Object.keys(e);for(t=0;t<n.length;t++)o=n[t],a.indexOf(o)>=0||(r[o]=e[o]);return r}(e,a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(t=0;t<n.length;t++)o=n[t],a.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var l=t.createContext({}),p=function(e){var a=t.useContext(l),o=a;return e&&(o="function"==typeof e?e(a):i(i({},a),e)),o},c=function(e){var a=p(e.components);return t.createElement(l.Provider,{value:a},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var a=e.children;return t.createElement(t.Fragment,{},a)}},d=t.forwardRef((function(e,a){var o=e.components,r=e.mdxType,n=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(o),d=r,k=u["".concat(l,".").concat(d)]||u[d]||m[d]||n;return o?t.createElement(k,i(i({ref:a},c),{},{components:o})):t.createElement(k,i({ref:a},c))}));function k(e,a){var o=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var n=o.length,i=new Array(n);i[0]=d;var s={};for(var l in a)hasOwnProperty.call(a,l)&&(s[l]=a[l]);s.originalType=e,s[u]="string"==typeof e?e:r,i[1]=s;for(var p=2;p<n;p++)i[p]=o[p];return t.createElement.apply(null,i)}return t.createElement.apply(null,o)}d.displayName="MDXCreateElement"},4952:(e,a,o)=>{o.r(a),o.d(a,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>n,metadata:()=>s,toc:()=>p});var t=o(7605),r=(o(9496),o(9613));const n={sidebar_position:3,slug:"security"},i="Recomenda\xe7\xf5es de seguran\xe7a",s={unversionedId:"docker/seguran\xe7a",id:"docker/seguran\xe7a",title:"Recomenda\xe7\xf5es de seguran\xe7a",description:"\xc9 de suma import\xe2ncia que imagens Docker - especialmente as de um ambiente de Produ\xe7\xe3o - estejam com o menor n\xfamero poss\xedvel de vulnerabilidades e estejam seguindo boas pr\xe1ticas de seguran\xe7a. A seguir ser\xe3o listados alguns pontos para observar quando voc\xea estiver criando um Dockerfile e docker-compose.yml.",source:"@site/docs/docker/seguran\xe7a.md",sourceDirName:"docker",slug:"/docker/security",permalink:"/docs/docker/security",draft:!1,editUrl:"https://github.com/hotaydev/hotaydev.github.io/tree/main/docs/docker/seguran\xe7a.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,slug:"security"},sidebar:"tutorialSidebar",previous:{title:"Otimiza\xe7\xe3o de Build",permalink:"/docs/docker/otimization"},next:{title:"Pipelines",permalink:"/docs/category/pipelines"}},l={},p=[{value:"1. Mantenha o Docker atualizado",id:"1-mantenha-o-docker-atualizado",level:3},{value:"2. Configure um usu\xe1rio sem permiss\xf5es root",id:"2-configure-um-usu\xe1rio-sem-permiss\xf5es-root",level:3},{value:"3. N\xe3o exponha a socket do Docker daemon",id:"3-n\xe3o-exponha-a-socket-do-docker-daemon",level:3},{value:"4. Rode com a flag \u2013no-new-privileges",id:"4-rode-com-a-flag-no-new-privileges",level:3},{value:"5. Defina o n\xedvel de log para, no m\xednimo, INFO",id:"5-defina-o-n\xedvel-de-log-para-no-m\xednimo-info",level:3},{value:"6. Especifique a assinatura da imagem base",id:"6-especifique-a-assinatura-da-imagem-base",level:3},{value:"7. N\xe3o copie a pasta .git para o container",id:"7-n\xe3o-copie-a-pasta-git-para-o-container",level:3},{value:"8. Utilize ferramentas de an\xe1lise est\xe1tica",id:"8-utilize-ferramentas-de-an\xe1lise-est\xe1tica",level:3}],c={toc:p},u="wrapper";function m(e){let{components:a,...o}=e;return(0,r.kt)(u,(0,t.Z)({},c,o,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"recomenda\xe7\xf5es-de-seguran\xe7a"},"Recomenda\xe7\xf5es de seguran\xe7a"),(0,r.kt)("p",null,"\xc9 de suma import\xe2ncia que imagens Docker - especialmente as de um ambiente de Produ\xe7\xe3o - estejam com o menor n\xfamero poss\xedvel de vulnerabilidades e estejam seguindo boas pr\xe1ticas de seguran\xe7a. A seguir ser\xe3o listados alguns pontos para observar quando voc\xea estiver criando um ",(0,r.kt)("inlineCode",{parentName:"p"},"Dockerfile")," e ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose.yml"),"."),(0,r.kt)("h3",{id:"1-mantenha-o-docker-atualizado"},"1. Mantenha o Docker atualizado"),(0,r.kt)("p",null,"Sempre utilize a \xfaltima vers\xe3o do Docker, ela quase sempre vai conter corre\xe7\xf5es de seguran\xe7a. Pode atualizar com:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo apt update && \\\nsudo apt upgrade docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin\n")),(0,r.kt)("p",null,"Para quem usa Windows ou ",(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/desktop/"},"Docker Desktop"),", a interface do programa vai avisar quando tiver uma atualiza\xe7\xe3o dispon\xedvel e oferecer\xe1 tutoriais para a atualiza\xe7\xe3o."),(0,r.kt)("h3",{id:"2-configure-um-usu\xe1rio-sem-permiss\xf5es-root"},"2. Configure um usu\xe1rio sem permiss\xf5es root"),(0,r.kt)("p",null,"Uma grande parte das imagens s\xe3o criadas a partir do Alpine, que tem por padr\xe3o o ",(0,r.kt)("a",{parentName:"p",href:"https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-5021"},"usu\xe1rio root, sem senha"),". Isso se caracteriza como um problema grave de seguran\xe7a, que pode ser corrigido das seguintes formas:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Ao rodar a imagem direto pelo Docker:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"docker run -u 4000 alpine\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Pela configura\xe7\xe3o do Dockerfile")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"FROM alpine\nRUN addgroup -S nonroot && adduser -S nonroot -G nonroot\n\n# Aqui realize as a\xe7\xf5es que precisam ser feitas como usu\xe1rio root, como a instala\xe7\xe3o de pacotes\n\nUSER nonroot\n")),(0,r.kt)("h3",{id:"3-n\xe3o-exponha-a-socket-do-docker-daemon"},"3. N\xe3o exponha a socket do Docker daemon"),(0,r.kt)("p",null,"A socket do Docker ",(0,r.kt)("inlineCode",{parentName:"p"},"/var/run/docker.sock")," \xe9 o ponto de acesso \xe0 API do Docker em sistemas UNIX. O dono desta socket \xe9 o usu\xe1rio root e, ao expor esta socket ao container, \xe9 o mesmo que dar ao usu\xe1rio do container acesso root ao seu host."),(0,r.kt)("p",null,"Para previnir issto, jamais rode nenhum container pela linha de comando passando o par\xe2metro ",(0,r.kt)("inlineCode",{parentName:"p"},"-v /var/run/docker.sock:/var/run/docker.sock"),"."),(0,r.kt)("p",null,"E ao trabalhar com Docker COmpose, jamais fa\xe7a o seguinte bind de volumes:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'volumes:\n  - "/var/run/docker.sock:/var/run/docker.sock"\n')),(0,r.kt)("h3",{id:"4-rode-com-a-flag-no-new-privileges"},"4. Rode com a flag \u2013no-new-privileges"),(0,r.kt)("p",null,"Sempre rode seus containers passando a flag ",(0,r.kt)("inlineCode",{parentName:"p"},"--security-opt=no-new-privileges"),". Isso previne ataques de escala\xe7\xe3o de privil\xe9gios utilizando os bin\xe1rios ",(0,r.kt)("inlineCode",{parentName:"p"},"setuid")," e ",(0,r.kt)("inlineCode",{parentName:"p"},"setgid"),"."),(0,r.kt)("p",null,"Trabalhando com Docker Compose, isso pode ser configurado utilizando o atributo ",(0,r.kt)("inlineCode",{parentName:"p"},"security_opt"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"security_opt:\n  - no-new-privileges:true\n")),(0,r.kt)("h3",{id:"5-defina-o-n\xedvel-de-log-para-no-m\xednimo-info"},"5. Defina o n\xedvel de log para, no m\xednimo, INFO"),(0,r.kt)("p",null,"Rodando com Docker Compose, basta utilizar a flag ",(0,r.kt)("inlineCode",{parentName:"p"},"--log-level"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"docker-compose --log-level info up\n")),(0,r.kt)("p",null,"O n\xedvel de log pode ser ",(0,r.kt)("inlineCode",{parentName:"p"},"debug"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"info"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"warn"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"error")," e ",(0,r.kt)("inlineCode",{parentName:"p"},"fatal"),"."),(0,r.kt)("h3",{id:"6-especifique-a-assinatura-da-imagem-base"},"6. Especifique a assinatura da imagem base"),(0,r.kt)("p",null,"Na hora de rodar o projeto, geralmente \xe9 usado apenas o nome da imagem e sua vers\xe3o, por exemplo ",(0,r.kt)("inlineCode",{parentName:"p"},"alpine:3.18.4")," (sempre prefira usar vers\xf5es fixas ao inv\xe9s de ",(0,r.kt)("inlineCode",{parentName:"p"},"latest"),", para garantir que sua aplica\xe7\xe3o continue compat\xedvel com a vers\xe3o da imagem de base). Por\xe9m, em projetos open source sempre h\xe1 a possibilidade de algum contribuidor mal-intencionado envie uma altera\xe7\xe3o danosa propositalmente. \xc9 raro, mas j\xe1 aconteceu no passado."),(0,r.kt)("p",null,"Por este motivo, para garantir que a imagem que voc\xea est\xe1 utilizando no seu projeto \xe9 original, e n\xe3o uma imagem diferente substituindo a original, certifique-se de adicionar a hash de valida\xe7\xe3o da imagem, da seguinte forma:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"alpine:3.18.4@sha256:48d9183eb12a05c99bcc0bf44a003607b8e941e1d4f41f9ad12bdcc4b5672f86\n")),(0,r.kt)("p",null,"A hash SHA256 da imagem pode ser obtida no ",(0,r.kt)("a",{parentName:"p",href:"https://hub.docker.com/"},"Docker Hub"),", ao selecionar a vers\xe3o pretendida. A hash ir\xe1 aparecer logo abaixo do nome da imagem.  "),(0,r.kt)("h3",{id:"7-n\xe3o-copie-a-pasta-git-para-o-container"},"7. N\xe3o copie a pasta .git para o container"),(0,r.kt)("p",null,"Jamais copie a pasta .git para dentro do Container. Adicione esta pasta ao ",(0,r.kt)("inlineCode",{parentName:"p"},".dockerignore"),"."),(0,r.kt)("p",null,"Desta forma evitamos a exposi\xe7\xe3o de informa\xe7\xf5es confidenciais como o nome e email dos usu\xe1rios que contribuem para o projeto, hist\xf3rico de commits e codigo fonte do projeto."),(0,r.kt)("h3",{id:"8-utilize-ferramentas-de-an\xe1lise-est\xe1tica"},"8. Utilize ferramentas de an\xe1lise est\xe1tica"),(0,r.kt)("p",null,"Existem diversas ferramentas para an\xe1lise est\xe1tica de configura\xe7\xf5es Docker (assim como an\xe1lises de c\xf3digo dos projetos). Algumas das melhores ferramentas s\xe3o:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Gratuitas")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/quay/clair"},"Clair")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/deepfence/ThreatMapper"},"ThreatMapper")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/aquasecurity/trivy"},"Trivy")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Comerciais")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://snyk.io/"},"Snyk")," (open source e com op\xe7\xe3o gratuita dispon\xedvel)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://anchore.com/opensource/"},"anchore")," (open source e com op\xe7\xe3o gratuita dispon\xedvel)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://jfrog.com/xray/"},"JFrog XRay")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.qualys.com/apps/container-security/"},"Qualys")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Para encontrar ",(0,r.kt)("strong",{parentName:"p"},"secrets e vari\xe1veis expostas")," em containers:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/GitGuardian/ggshield"},"ggshield")," (open source e com op\xe7\xe3o gratuita dispon\xedvel)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/deepfence/SecretScanner"},"SecretScanner")," (open source)")))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Para detectar ",(0,r.kt)("strong",{parentName:"p"},"configura\xe7\xf5es incorretas")," e inseguras em ",(0,r.kt)("strong",{parentName:"p"},"Kubernetes"),":"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/Shopify/kubeaudit"},"kubeaudit")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://kubesec.io/"},"kubesec.io")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/aquasecurity/kube-bench"},"kube-bench")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Para detectar ",(0,r.kt)("strong",{parentName:"p"},"configura\xe7\xf5es incorretas")," e inseguras no ",(0,r.kt)("strong",{parentName:"p"},"Docker"),":"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.chef.io/inspec/resources/docker/"},"inspec.io")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://dev-sec.io/baselines/docker/"},"dev-sec.io")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/docker/docker-bench-security"},"docker-bench-security"))))),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Estas s\xe3o apenas as recomenda\xe7\xf5es mais gen\xe9ricas. Para uma vis\xe3o ampliada, com mais recomenda\xe7\xf5es, visite a ",(0,r.kt)("a",{parentName:"p",href:"https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html"},"Cheat Sheet da OWASP"),".")))}m.isMDXComponent=!0}}]);